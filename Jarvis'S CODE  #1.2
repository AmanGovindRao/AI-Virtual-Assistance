#Date - 6.14.2021
#version - 1.2



from logging import exception
from math import trunc
import sys
from requests.models import codes
import speech_recognition as sr 
import datetime
import wikipedia
import pyttsx3
import webbrowser
import random
import os
import pywikihow

#Text To Speech

engine = pyttsx3.init('sapi5')
voices = engine.getProperty('voices')
#print(voices)
engine.setProperty('voice',voices[2].id)

def speak(audio):  #here audio is var which contain text
    engine.say(audio)
    engine.runAndWait()

def wish():
    hour = int(datetime.datetime.now().hour)
    if hour >= 0 and hour<12:
        print("Good Morning sir I am jarvis")
        speak("good morning sir I am jarvis")
    elif hour>=12 and hour<18:
        print("Good Afternoon Sir I am jarvis")
        speak("good afternoon sir I am jarvis")
    else:
        print("Good Night Sir I am jarvis")
        speak("good night sir I am jarvis")

#now convert audio to text
# 
def takecom():
    r = sr.Recognizer()
    with sr.Microphone(device_index=1) as source:
        print("Listning....")
        speak("Listning")
        audio = r.listen(source)
    try:
        print("Recognising......") 
        text = r.recognize_google(audio,language='en-in')
        print(text)
    except Exception:                #For Error handling
        speak("Error...")
        print("Network connection error") 
        return "none"
    return text

#for main function                               
def Taskexcution():
    wish()
    while True:
        query = takecom().lower()

        if "wikipedia" in query:
            speak("searching details....Wait")
            print("searching details....Wait")
            query.replace("wikipedia","")
            results = wikipedia.summary(query,sentences=2)
            print(results)
            speak(results)
        
        elif 'open youtube' in query or "open video online" in query:
            webbrowser.open("www.youtube.com")
            speak("opening youtube")
            print("opening youtube")

        elif "youtube search" in query:
            speak("okay sir this is searching now")
            query = query.replace("jarvis","")
            query = query.replace("youtube search","")
            web = 'https://www.youtube.com/results?search_query=' + query
            webbrowser.open(web)
            speak("done sir")

        elif 'open github' in query:
            webbrowser.open("https://www.github.com")
            speak("opening github")
 
        elif 'open facebook' in query:
            webbrowser.open("https://www.facebook.com")
            speak("opening facebook")
  
        elif 'open instagram' in query:
            webbrowser.open("https://www.instagram.com")
            speak("opening instagram")
   
        elif 'open google' in query:
            webbrowser.open("https://www.google.com")
            speak("opening google")
            
        elif 'open yahoo' in query:
            webbrowser.open("https://www.yahoo.com")
            speak("opening yahoo")
            
        elif 'open gmail' in query:
            webbrowser.open("https://mail.google.com")
            speak("opening google mail") 
            
        elif 'open snapdeal' in query:
            webbrowser.open("https://www.snapdeal.com") 
            speak("opening snapdeal")  
             
        elif 'open amazon' in query or 'shop online' in query:
            webbrowser.open("https://www.amazon.com")
            speak("opening amazon")
        
        elif 'open flipkart' in query:
            webbrowser.open("https://www.flipkart.com")
            speak("opening flipkart")
  
        elif 'open ebay' in query:
            webbrowser.open("https://www.ebay.com")
            speak("opening ebay")

        elif 'music from pc' in query or "music" in query:
            speak("ok i am playing music")
            music_dir = './music'
            musics = os.listdir(music_dir)
            os.startfile(os.path.join(music_dir,musics[0]))

        elif "show my photo" in query or "show my photos" in query:
            speak("okay, showing your photo")
            pic_dir = 'D:\hm\my_photo'
            pics = os.listdir(pic_dir)
            os.startfile(os.path.join(pic_dir,pics[0]))

        elif "show my another photo" in query or "show my another photo" in query:
            speak("okay, showing your another photo")
            pic_dir = 'D:\hm\my_photos2'
            pics = os.listdir(pic_dir)
            os.startfile(os.path.join(pic_dir,pics[0]))

        elif "show my brother photo" in query or "show my brother pic" in query or "show my brother photos" in query:
            speak("okay, showing your brother photo")
            pic_dir = 'D:\hm\my_brother'
            pics = os.listdir(pic_dir)
            os.startfile(os.path.join(pic_dir,pics[0]))

        elif 'video from pc' in query or "video" in query:
            speak("ok i am playing videos")
            video_dir = './video'
            videos = os.listdir(music_dir)
            os.startfile(os.path.join(video_dir,videos[0]))
      
        elif "what\'s up" in query or 'how are you' in query:
            stMsgs = ['Just doing my thing!', 'I am fine!', 'Nice!', 'I am nice and full of energy','i am okey ! How about you']
            ans_q = random.choice(stMsgs)
            speak(ans_q)  
            ans_take_from_user_how_are_you = takecom()
            if 'fine' in ans_take_from_user_how_are_you or 'happy' in ans_take_from_user_how_are_you or 'okey' in ans_take_from_user_how_are_you:
                speak('okey..')  
            elif 'not' in ans_take_from_user_how_are_you or 'sad' in ans_take_from_user_how_are_you or 'upset' in ans_take_from_user_how_are_you:
                speak('oh sorry..')

        elif 'who make you' in query or 'who created you' in query or 'who develop you' in query:
            ans_m = " For  your  information  Aman Rajput  Created me, ! I give Lot of Thannks to Him "
            print(ans_m)
            speak(ans_m)
        
        elif "who are you" in query or "about you" in query or "your details" in query:
            about = "I am Jarvis an A I based computer program but i can help you lot like a your close friend ! i promise you ! Simple try me to give simple command ! like playing music or video from your directory i also play video and song from web or online ! i can also entain you i so think you Understand me ! ok Lets Start "
            print(about)
            speak(about)
        
        elif "hello" in query or "hello Jarvis" in query:
            hel = "Hello Sir ! How May i Help you.."
            print(hel)
            speak(hel)
        
        elif "your name" in query or "sweat name" in query or "what is your name" in query or "what\'s your real name" in query:
            na_me = "Thanks for Asking my name my self ! Jarvis"  
            print(na_me)
            speak(na_me)

        elif "what is your favourite word" in query:
            print("Never Ever Give up,   and  Always keep Trying and Always learn Something")
            speak("my favroite word is, never ever give up and always keep trying and always learn something")
        
        elif "what do you feel" in query or "what about your feeling" in query:
            print("feeling Very sweet after meeting with you")
            speak("feeling Very sweet after meeting with you")


        elif "shutdown" in query:
            speak("shutting down")
            os.system('shutdown -s')

        elif 'exit' in query or 'abort' in query or 'stop' in query or 'bye' in query or 'quit' in query :
            ex_exit = 'I feeling very sweet after meeting with you but you are going! i am very sad'
            speak(ex_exit)
            exit()
 
        elif query == 'none':
            continue

        elif "sleep" in query or "you can sleep jarvis" in query or "sleep jarvis" in query or "you need a break" in query or "jarvis you can sleep" in query or "jarvis you can sleep now" in query:
            speak("okay sir i am going to sleep, you can call me anytime.")
            print("Ok... sir I am going to sleep, You can call me anytime.")
            break

        

        elif "activate how to do mode" in query:
            speak("how to do mode is activated")
            from pywikihow import search_wikihow
            while True:
                speak("please tell me what you want know")
                how = takecom()
                try:
                    if "exit" in how or "close" in how:
                        speak("okay sir, how to do mode is closed")
                        break
                    else:
                        max_results = 1
                        how_to = search_wikihow(how, max_results)
                        assert len(how_to) -- 1
                        how_to[0].print()
                        speak(how_to[0].summary)
                except Exception as e:
                    speak("sorry sir  i am not  able  find  this")


        else:
            temp = query.replace(' ','+')    
            res_g = 'sorry! i cant understand, please say again'
            print(res_g)
            speak(res_g)




if __name__ == "__main__":
    while True:
        Permission = takecom()
        if "wake up" in Permission or "activate" in Permission:
            Taskexcution()
        elif "bye jarvis" in Permission or "bye" in Permission:
            speak("thanks for using me sir, have a good day")
            print("thanks for using me sir, have a good day")
            sys.exit()
